<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Call-feature-service-Leaflet by bricker0</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Call-feature-service-Leaflet</h1>
        <h2>Here I explain how to call Seattle Open Data Esri Feature Services using Leaflet.</h2>
        <a href="https://github.com/bricker0/Seattle-Feature-Service" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="seattle-feature-service" class="anchor" href="#seattle-feature-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Seattle-Feature-Service</h1>

<p>Here I show how to call Seattle Open Data Esri Feature Services using Leaflet. 
This example is based on this <a href="http://esri.github.io/esri-leaflet/tutorials/working-with-feature-layers.html">Esri Custom popup tutorial.</a> </p>

<p>Seattle offers many stylized feature services that you may incorporate to create mashups. When looking through <a href="https://gisrevprxy.seattle.gov/arcgis/rest/services/ext/WM_CityGISLayers/MapServerl">Seattle data here</a>, I decided to feature heritage trees in Seattle using this<a href="https://esri.github.io/esri-leaflet/examples/feature-layer-popups.html">Tree data found here </a>. Before you commit to a data set you can browse what is contained within the data set when you click ArcGIS Online MapViewer on the data page. </p>

<h2>
<a id="lets-get-started" class="anchor" href="#lets-get-started" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Let's get started</h2>

<p>I first provide you with basic HTML requirements to get started. You will see the title of the page is "Calling Features with Leaflet", we are calling javascript libraries, the map is stylized to fill the whole screen, the center of the map is set to Seattle and zoom level is appropriately framing Seattle.</p>

<p>Start with the following: </p>

<pre><code>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;  
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;Calling Features with Leaflet&lt;/title&gt;  
  &lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;

  &lt;!-- Load Leaflet from CDN--&gt;
  &lt;link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.7/dist/leaflet.css" /&gt;
  &lt;script src="https://unpkg.com/leaflet@0.7.7/dist/leaflet.js"&gt;&lt;/script&gt;

  &lt;!-- Load Esri Leaflet from CDN --&gt;
  &lt;script src="https://cdn.jsdelivr.net/leaflet.esri/1.0.4/esri-leaflet.js"&gt;&lt;/script&gt;

  &lt;style&gt;
    html,
    body,
    #map {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;    
    &lt;div id="map"&gt;&lt;/div&gt;

    &lt;script&gt;
         var map = L.map('map').setView([47.6062, -122.3321], 12)
        });

        var esriStreets = L.esri.basemapLayer('Topographic').addTo(map);


    &lt;/script&gt;    
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>This will provide us with a Topographic base map that fills the browser frame.</p>

<p>Now let's add that tree data to feature! You have looked around what Seattle has to offer in terms of data on this one Esri Server. As I mentioned, I am using the heritage tree data. I want to add this data to the page so under the map variable and before I close the script tag. I will name the variable seattleHeriageTrees to call the feature layer and add it to the map. I add tags to remind me what the code does. </p>

<pre><code> //set the tree variable to call the server to then display or add to the map
        var seattleHeritageTrees = L.esri.featureLayer({url: 'https://gisrevprxy.seattle.gov/arcgis/rest/services/ext/WM_CityGISLayers/MapServer/33'}).addTo(map);

</code></pre>

<p>If we open the code now, you will see the default pin markers and nothing else. We can see from the Esri REST Service directory page that symbology has been set, it is a tree. We need to tell the browser to get that style. To do so we add the following to the head. </p>

<pre><code>&lt;!-- Load Esri Leaflet Renderers from CDN --&gt;
&lt;script src="https://cdn.jsdelivr.net/leaflet.esri.renderers/1.0.1/esri-leaflet-renderers.js"&gt;&lt;/script&gt;
</code></pre>

<p>Now the blue dots should be replaced with trees! </p>

<p>Next, we need to add the popup window to say something meaningful. We do not want a laundry list of all the attributes that Esri Online provides. We only want to share what the end users need to see. I can see all the attributes available, from these, I decide I only want to share. I decided to simply share the common and scientific names of the tree selected.</p>

<p>I added the following just under the add to map. Again, I added comments to remember what I am showing.</p>

<pre><code> //customize the popup, do you no present a laundry list of attributes, think about what the end user needs to know.
        seattleHeritageTrees.bindPopup(function(feature) {
    return L.Util.template('&lt;h3&gt;{DESCRIPT }&lt;/h3&gt;&lt;hr /&gt;&lt;p&gt; Its scientific name is {SCINAME}.', feature.properties);
</code></pre>

<p>Hooray! Now when I click a tree, meaningful information pops up. This is fun so I want to add more information. </p>

<h1>
<a id="add-another-layer" class="anchor" href="#add-another-layer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add another layer</h1>

<p>I want to see if these trees are close to heritage landmarks. I can see that there is a Landmarks layer. I will make a new variable called Seattle landmarks and add it to the map. I add this next bit just under the add to map. </p>

<pre><code> //set the Seattle Landmarks variable call the server to then display or add to the map
        var seattleLandmarks = L.esri.featureLayer({url: 'https://gisrevprxy.seattle.gov/arcgis/rest/services/ext/WM_CityGISLayers/MapServer/55'}).addTo(map);
</code></pre>

<p>I need popup information for this new layer too. I see what attributes are available and decide to share information about the address and how long this site has been recognized. I add the following under the feature properties</p>

<pre><code>  //popup information for landmarks

  seattleLandmarks.bindPopup(function(feature) {
            return L.Util.template('&lt;h3&gt;{NAME}&lt;/h3&gt;&lt;hr /&gt;&lt;p&gt;This landmark is located at {ADDRESS} and has been recognized since {EFF_DATE}.', feature.properties);

         });       

</code></pre>

<p>The dates look bizarre so I decide to remove that from the label, it is meaningless! 
Now we should see trees and landmarks. Fun! Let's keep going!</p>

<h1>
<a id="add-basemap-selector" class="anchor" href="#add-basemap-selector" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add basemap selector</h1>

<p>I want to user to be able to change the base maps if they would like. </p>

<p>Add the following into the style tag. Make sure you place it properly, after the } the close of the #map</p>

<pre><code>#basemaps-wrapper {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 400;
    background: white;
    padding: 10px;
  }
  #basemaps {
    margin-bottom: 5px;
  }
</code></pre>

<p>Then we need to add the div to place the dropdown within the frame. </p>

<pre><code> &lt;div id="basemaps-wrapper" class="leaflet-bar"&gt;
  &lt;select name="basemaps" id="basemaps" onChange="changeBasemap(basemaps)"&gt;
    &lt;option value="Topographic"&gt;Topographic&lt;/option&gt;
    &lt;option value="Streets"&gt;Streets&lt;/option&gt;
    &lt;option value="NationalGeographic"&gt;National Geographic&lt;/option&gt;
    &lt;option value="Oceans"&gt;Oceans&lt;/option&gt;
    &lt;option value="Gray"&gt;Gray&lt;/option&gt;
    &lt;option value="DarkGray"&gt;Dark Gray&lt;/option&gt;
    &lt;option value="Imagery"&gt;Imagery&lt;/option&gt;
    &lt;option value="ShadedRelief"&gt;Shaded Relief&lt;/option&gt;
  &lt;/select&gt;
&lt;/div&gt;
</code></pre>

<p>Looks great! </p>

<h2>
<a id="that-is-all-for-now" class="anchor" href="#that-is-all-for-now" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>That is all for now</h2>

<p>Here you have learned to call data straight from an Esri server. Awesome! There are so many different ways to call feature layers. <a href="http://esri.github.io/esri-leaflet/tutorials/introduction-to-layer-types.html">See more examples here.</a> Enjoy!</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/bricker0/Seattle-Feature-Service/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/bricker0/Seattle-Feature-Service/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/bricker0/Seattle-Feature-Service"></a> is maintained by <a href="https://github.com/bricker0">bricker0</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
